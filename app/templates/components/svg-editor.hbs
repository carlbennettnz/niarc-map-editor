<svg class="map" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <pattern
      id="grid-pattern"
      x={{viewport.scrollX}}
      y={{totalYOffset}}
      width={{scale gridSize viewport.zoom}}
      height={{scale gridSize viewport.zoom}}
      patternUnits="userSpaceOnUse">
      <line x1="0" y1="0" x2="0" y2={{scale gridSize viewport.zoom}} />
      <line x1="0" y1="0" x2={{scale gridSize viewport.zoom}} y2="0" />
    </pattern>
  </defs>

  <rect fill="url(#grid-pattern)" x="0" y="0" width="100%" height="100%"/>

  {{! x and y axes }}
  <line class="axes x" x1="0" y1={{totalYOffset}} x2="100%" y2={{totalYOffset}}></line>
  <line class="axes y" y1="0" x1={{viewport.scrollX}} y2="100%" x2={{viewport.scrollX}}></line>

  <g class="scroll-offset {{selectedLayerName}}-layer-selected" transform={{scrollTransform}}>
    {{#each layers as |layer|}}
      {{#if layer.isVisible}}
        {{#each shapes as |shape|}}
          {{#unless shape.isHidden}}
            {{component (concat 'svg-shapes/' shape.type)
              line=shape
              viewport=viewport
              selectedEventIds=selectedEventIds
              highlightedEventId=highlightedEvent.id
              tagName=''}}
          {{/unless}}
        {{/each}}
      {{/if}}
    {{/each}}

    {{#if (and (eq tool 'selection') toolState.selection.show)}}
      <rect class="selection-marquee"
        x={{scale toolState.selection.x viewport.zoom}}
        y={{scale toolState.selection.y viewport.zoom}}
        width={{scale toolState.selection.w viewport.zoom}}
        height={{scale toolState.selection.h viewport.zoom}}></rect>
    {{/if}}
  </g>
</svg>
